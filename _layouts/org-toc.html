{% if page.title and page.section and page.mission %}
  {% capture the_title %}{{ page.section }}-{{page.mission}} {{ page.title }}{% endcapture %}
{% else %}
  {% capture the_title %}{{ page.title }}{% endcapture %}
{% endif %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ the_title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
  </head>
  <body>
    <div class="container markdown-body">
      <!-- {% include tm/mission_header.html %} -->

      {{ content }}

      <!-- {% include tm/mission_footer.html %} -->
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    {% if jekyll.environment == "production" %}
      <script src="https://unpkg.com/vue@2.3.3/dist/vue.min.js"></script>
      <script src="https://unpkg.com/vue-router@2.6.0/dist/vue-router.min.js"></script>
    {% else %}
      <script src="https://unpkg.com/vue@2.3.3"></script>
      <script src="https://unpkg.com/vue-router@2.6.0/dist/vue-router.js"></script>
    {% endif %}

    <script type="text/javascript">




      var toc_component = Vue.component('toc-component', {
        template: '<div>TOC</div>',
        data: function() {
          return this.page_data
        }
      })

      var mission_component = Vue.component('mission-component', {
        template: '#mission-component-template',
        data: function() {
          return this.page_data
        }
      })

      var routes = [
        { path: '/', component: toc_component },
        { path: '/mission', component: mission_component },
      ]

      var router = new VueRouter({
        routes: routes
      })


      var app = new Vue({
        el: "#app",
        router: router,
        data: {
          current_mission: null,
          toc: page_data.toc,
          page_data: page_data,
          current_title: page_data.title,
        },

        methods: {
          open_mission: function(mission) {
            console.log("loading: " + mission.mid)
            axios.get("/missions/"+ mission.mid +"/index.html")
              .then(function(response){
                app.current_mission = {html: response.data, title: mission.mname};
                app.current_title = mission.mname;
                console.log(response);
              })
          },

          close_mission: function() {
            console.log("closing mission!");
            app.current_mission = null;
            app.current_title = page_data.title;
          },

          update_history_hash: function(event) {
            if (current_mission) {
              this.close_mission;
              event.preventDefault();
            }
          }

        },
        computed: {

        },
        mounted: function(){}

      }); // vue




    </script>

    {% include ga.html %}
  </body>
</html>
